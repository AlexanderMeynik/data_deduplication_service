[На страницу с документацией](README.md)
# Архитектура проекта

## Цель и задачи работы
Цель работы состоит в реализации системы оптимального хранения данных за счет
использования подхода дедупликации данных и проведении тестирования для измерения
производительности созданного прототипа.

Задачи, которые требуется решить для достижения цели:
- изучить подходы к оптимизации хранения данных в традиционных базах данных;
- выбрать стек технологий, необходимый для создания прототипа системы
дедупликации; разработать систему оптимального хранения данных на диске;
- провести нагрузочное тестирование и установить зависимость скорости
чтения/записи данных в локальное хранилище в зависимости от размера сегмента;
- установить оптимальный размер сегмента блока данных, при котором наблюдается
  -  максимальная скорость записи
  - максимальная скорость чтения
  - процент ошибки восстановления данных в зависимости от использованного
  алгоритма hash.

В обобщённом представлении архитектуру проекта можно представить в виде
диаграммы ниже:

<p align="center">
<img alt="arhc.svg" src="images%2Farhc.svg" align="center"/>
</p>


Данная схема примерно отражает ключевые особенности взаимодействия элементов
в данной системе, однако многие моменты для наглядности здесь опущены.
1. Библиотека файловых сервисов предоставляет основной функционал для работы
   сервиса в виде двух классов FilesService и DatabaseService. Доплнительный
   функционал, который может применяться вместе с ними находиться в пространства
   имён db_services и file_services соответственно.
2. Для хэширования строк используется библиотека OpenSSL. Во время вставки
   содержимого файла вызывается функция getHashStr.
3. Взаимодействие между базой данных и кодом происходит через библиотеку pqxx
   через библиотечный класс pqxx::connection[9]




### Схема базы данных
ER диаграмма базы данных представлена ниже:
<p align="center">
<img alt="database.svg" src="images%2Fdatabase.svg" width="600" 
     height="auto">
</p>
Сущности БД:

1. Таблица файлы(files) – содержит основную информацию о файлах, загружаемых в систему. Помимо этого, данная таблица может содержать записи заглушки директорий. 
Для поля file_name был создан GIN индекс для реализации дальнейшей возможности полнотекстового поиска по имени файла.
2. Таблица хэш-функций(hash_functions) – содержит названия хэш-функций, а также
размеры выходных массивы для хэшей. Данная информации импортируется из кода
во время создания базы данных.
3. Таблица сегменты(segments) – содержит данные блоков вместе с их хэшами, а также
числом использований в файлах. Поле с хэшем является первичным ключом. Данное
ограничение позволяет быстрее объединять данную таблицу с таблицами данные.
4. Таблица данные(data) – содержит хэши блоков с их позицией в файле и id данного
файла. Для поля id файла был создан индекс для ускорения фильтрации по файлам.

## Диаграммы для основных методов работы с файлами
### Загрузка файла в систему
<p align="center">
<img alt="processFile.svg" height="auto" src="images%2FprocessFile.svg"
width="600"/>
</p>

[Подробнее ...](implementationDetails.md#загрузка-файла-в-систему)

### Выгрузка файла
<p align="center">
<img alt="loadFile.svg" height="auto" src="images%2FloadFile.svg"
width="600"/>
</p>

[Подробнее ...](implementationDetails.md#выгрузка-файла)

### Удаление файла
<p align="center">
<img alt="deleteFile.svg" height="auto" src="images%2FdeleteFile.svg"
width="600"/>
</p>

[Подробнее ...](implementationDetails.md#удаление-файла)




[На страницу с документацией](README.md)
