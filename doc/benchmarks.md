

## Описание контрольной процедуры измерения
Для сбора необходимых метрик и запуска библиотеки обработки файлов для разного
набора конфигураций было принято решение написать отдельный файл benchmark.cpp и
создать отдельный [workflow](https://github.com/AlexanderMeynik/data_deduplication_service/actions/workflows/benchmark.yml) для проведения данных измерений и сбора необходимых
данных.
Данная процедура приводиться для всех комбинаций конфигураций из следующих
двух массивов:

```c++
constexpr std::array<int,6> indx= {0,1,2,3,4,5};
constexpr std::array<int,10> segmentsSizes={2,4,8,16,64,256,512,1024,2048,4096};
constexpr std::array<unsigned char *(*)(const unsigned char *d, size_t n, unsigned char
*md), 6> funcs
= {&SHA224, &SHA256,&MD5, &SHA384, &SHA512,&MD4};
```
В данном случае массив indx содержит номера хэш функции среди funcs. А второй
массив содержит размеры блоков.
В качестве источника данных было принято решение выбрать директорию с 3
изображениями высокого разрешения и суммарным размером 16,5 МБ:
<p align="center">
<img alt="imageList.png" height="auto" src="images%2FimageList.png"
width="450"/>
</p>

А также вторая директория с небольшим набором
текстовых файлов разного размера:
<p align="center">
<img alt="textFiles.png" height="auto" src="images%2FtextFiles.png"
width="450"/>
</p>

Данный набор данных был сохранён в отдельный
[дистрибутив](https://github.com/AlexanderMeynik/data_deduplication_service/releases/tag/fixture) для облегчения
доступа к этим данным, а также из соображений экономии места на кодовом репозитории
(не стоит хранить огромный набор данных вместе с кодом).

Запуск данного тестирования производился при помощи вышеупомянутого workflow на
следующей [конфигурации](https://docs.github.com/en/actions/using-github-hosted-runners/using-github-hosted-runners/about-github-hosted-runners)
виртуальной машины:
- Операционная система: ubuntu 24.04.1 LTS;
- Число задействованных ядер процессора: 4;
- Размер оперативной памяти: 16 ГБ;
- Размер твердотельного накопителя: 14 ГБ;

В файле benchmark.cpp производиться следующий набор действий:
1. Создаётся база данных под текущую итерацию (с выбранной хэш функцией и
   размером блока);
2. Производиться загрузка данных директорий в систему;
3. Производиться выгрузка директорий обратно в другое место;
4. Производиться сбор и сохранение параметров дедупликации и пр. информации о
   сохранённых файлах/директориях;
5. Производиться удаление директорий из системы(deleteDirrectory).
6. Производиться удаление БД;
7. Загруженные файлы сравниваются выгруженными и результат сравнения
   сохраняется на диск;
8. Сохраняются данные временных измерений и их запись на диск;
   Полный набор собираемых временных метрик не будет описываться ввиду большого
   их числа. Стоит отметить, что в рамках исследования производительности внимание
   уделялось ключевым процедурам, время исполнения которых, могло зависеть от
   вышеописанных параметров. Например, время блочной вставки могло зависеть от выбора
   функции хэширования ввиду того, что эта функция непосредственно используется в составе
   данной процедуры.



[На страницу с документацией](README.md)