#include <iostream>


#include "./FileUtils/ServiceFileInterface.h"
#include <sstream>
#include "./dbUtils/lib.h"
#include <iostream>
#include <fstream>
#include <assert.h>




int main() {

    std::string res_dir_path = "../res/";
    std::string filename = res_dir_path.append("config.txt");
    auto cstring = getSc(filename,"deduplication");

    auto C= connect_if_possible(getSc(filename,"deduplication"));

    if (C->is_open()) {
        std::cout << "Opened database successfully: " << C->dbname() << std::endl;
    } else {
        std::cerr << "Connection failed" << std::endl;
        return -1;
    }


    std::stringstream ss{"1111111111111111"
                         "2222222222222222"
                         "3333333333333333"
                         "4444444444444444"
                         "5555555555555555"
                         "6666666666666666"
                         "7777777777777777"
                         "8888888888888888"
                         "9999999999999999"
                         "1111111111111111"
                         "2222222222222222"
                         "3333333333333333"
                         "4444444444444444"
                         "5555555555555555"
                         "6666666666666666"
                         "7777777777777777"
                         "8888888888888888"
                         "9999999999999999"
                         "1111111111111111"
                         "2222222222222222"
                         "3333333333333333"
                         "4444444444444444"
                         "5555555555555555"
                         "6666666666666666"
                         "7777777777777777"
                         "8888888888888888"
                         "9999999999999999"
                         "1111111111111111"
                         "2222222222222222"
                         "3333333333333333"
                         "4444444444444444"
                         "5555555555555555"
                         "6666666666666666"
                         "7777777777777777"
                         "8888888888888888"
                         "9999999999999999"
                         "1111111111111111"
                         "2222222222222222"
                         "3333333333333333"
                         "4444444444444444"
                         "5555555555555555"
                         "6666666666666666"
                         "7777777777777777"
                         "8888888888888888"
                         "9999999999999999"
                         "1111111111111111"
                         "2222222222222222"
                         "3333333333333333"
                         "4444444444444444"
                         "5555555555555555"
                         "6666666666666666"
                         "7777777777777777"
                         "8888888888888888"
                         "9999999999999999"
                         "1111111111111111"
                         "2222222222222222"
                         "3333333333333333"
                         "4444444444444444"
                         "5555555555555555"
                         "6666666666666666"
                         "7777777777777777"
                         "8888888888888888"
                         "9999999999999999"
                         "1111111111111111"
                         "2222222222222222"
                         "3333333333333333"
                         "4444444444444444"
                         "5555555555555555"
                         "6666666666666666"
                         "7777777777777777"
                         "8888888888888888"
                         "9999999999999999"
                         "1111111111111111"
                         "2222222222222222"
                         "3333333333333333"
                         "4444444444444444"
                         "5555555555555555"
                         "6666666666666666"
                         "7777777777777777"
                         "8888888888888888"
                         "9999999999999999"
                         "1111111111111111"
                         "2222222222222222"
                         "3333333333333333"
                         "4444444444444444"
                         "5555555555555555"
                         "6666666666666666"
                         "7777777777777777"
                         "8888888888888888"
                         "9999999999999999"
                         "1111111111111111"
                         "2222222222222222"
                         "3333333333333333"
                         "4444444444444444"
                         "5555555555555555"
                         "6666666666666666"
                         "7777777777777777"
                         "8888888888888888"
                         "9999999999999999"
                         "1111111111111111"
                         "2222222222222222"
                         "3333333333333333"
                         "4444444444444444"
                         "5555555555555555"
                         "6666666666666666"
                         "7777777777777777"
                         "8888888888888888"
                         "9999999999999999"
                         "1111111111111111"
                         "2222222222222222"
                         "3333333333333333"
                         "4444444444444444"
                         "5555555555555555"
                         "6666666666666666"
                         "7777777777777777"
                         "8888888888888888"
                         "9999999999999999"
                         "1111111111111111"
                         "2222222222222222"
                         "3333333333333333"
                         "4444444444444444"
                         "5555555555555555"
                         "6666666666666666"
                         "7777777777777777"
                         "8888888888888888"
                         "9999999999999999"
                         "1111111111111111"
                         "2222222222222222"
    };

    std::stringstream ss2{"1111111111111111"
                         "2222222222222222"
                         "3333333333333333"
                         "4444444444444444"
                          "1111111111111111"
                          "2222222222222222"
                          "3333333333333333"
                          "4444444444444444"};
    std::stringstream ss3{"1111111111111111"
                          "2222222222222222"
                          "3333333333333333"
                          "4444444444444444"};

    std::stringstream& sss=ss;
    buf64 buf;
    sss >> buf;
    std::string ffname = "test3";
    insert_bulk_segments(C,buf,ffname);


    buf64 out = get_file_segmented<64>(C, ffname);


    std::stringstream os;
    os<<out;

    assert(os.str()==sss.str());

    auto str= get_file_contents(C, ffname);

    assert(os.str()==str);
    std::cout<<ss.str();
    return 0;
}


